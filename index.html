<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Suivi Santé – PWA</title>
  
  <link rel="apple-touch-icon" href="icon.png">
  
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body class="bg-slate-900 text-white">
<div id="root"></div>

<script type="text/babel">

const { useState, useEffect } = React;

/* =========================
   DONNÉES HARD-CODÉES
========================= */

const SUPPLEMENTS = {
  matin_jeune: [
    { name: "Bleu de Méthylène", dose: "5 mg", info: "Focus mental – arrêter si antidépresseurs" },
    { name: "Optiflora DI", dose: "1 cap", info: "Santé intestinale" }
  ],
  matin: [
    { name: "Vita-D3", dose: "4000 UI", info: "Immunité – avec gras / K2" },
    { name: "Zinc Complex", dose: "1 cap", info: "Lundi à vendredi seulement" },
    { name: "Lécithine", dose: "1 gel", info: "Digestion des gras" }
  ],
  apres_midi: [
    { name: "Alfalfa Complex", dose: "10 cap", info: "Énergie douce / anti-inflammatoire" },
    { name: "Créatine", dose: "5 g", info: "Cerveau & muscle – 50 ans +" }
  ],
  souper: [
    { name: "Curcuma & Gingembre", dose: "—", info: "Digestion & inflammation" }
  ],
  coucher: [
    { name: "SynerMag (Magnésium)", dose: "—", info: "Sommeil profond" },
    { name: "Ashwagandha", dose: "300–600 mg", info: "Baisse cortisol – surveiller thyroïde" }
  ]
};

const STORAGE_KEY = "sante_app_v1";

/* =========================
   APP
========================= */

function App() {
  const [tab, setTab] = useState("suivi");
  const [data, setData] = useState(() => {
    return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
      water: 0,
      logs: {},
      scores: {},
      notes: {}
    };
  });

  useEffect(() => {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }, [data]);

  function toggleSupplement(block, name) {
    setData(prev => {
      const day = new Date().toISOString().slice(0,10);
      const logs = { ...prev.logs };
      logs[day] ??= {};
      logs[day][block] ??= {};
      logs[day][block][name] = !logs[day][block][name];
      return { ...prev, logs };
    });
  }

  function setScore(block, key, value) {
    setData(prev => {
      const day = new Date().toISOString().slice(0,10);
      const scores = { ...prev.scores };
      scores[day] ??= {};
      scores[day][block] ??= {};
      scores[day][block][key] = value;
      return { ...prev, scores };
    });
  }

  function setNote(block, text) {
    setData(prev => {
      const day = new Date().toISOString().slice(0,10);
      const notes = { ...prev.notes };
      notes[day] ??= {};
      notes[day][block] = text;
      return { ...prev, notes };
    });
  }

  function exportCSV() {
    let rows = [["Date","Bloc","Suppléments","Note","Énergie","Immunité","Stress"]];
    Object.keys(data.logs).forEach(date => {
      Object.keys(data.logs[date]).forEach(block => {
        rows.push([
          date,
          block,
          Object.keys(data.logs[date][block]).join(" | "),
          data.notes?.[date]?.[block] || "",
          data.scores?.[date]?.[block]?.energie || "",
          data.scores?.[date]?.[block]?.immunite || "",
          data.scores?.[date]?.[block]?.stress || ""
        ]);
      });
    });

    const csv = rows.map(r => r.map(v => `"${v}"`).join(",")).join("\n");
    const blob = new Blob([csv], { type: "text/csv" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "export_medecin.csv";
    a.click();
  }

  return (
    <div className="max-w-md mx-auto p-4">
      <h1 className="text-xl font-bold mb-4 text-center">Suivi Santé Quotidien</h1>

      {/* TABS */}
      <div className="flex justify-between mb-4">
        {["suivi","analyse","guide","parametres"].map(t => (
          <button
            key={t}
            onClick={() => setTab(t)}
            className={`px-3 py-1 rounded ${tab===t?"bg-blue-600":"bg-slate-700"}`}>
            {t.toUpperCase()}
          </button>
        ))}
      </div>

      {tab==="suivi" && (
        <>
          <Hydration data={data} setData={setData}/>
          <Block title="Matin à jeun" id="matin_jeune" />
          <Block title="Matin" id="matin" />
          <Block title="Après-midi" id="apres_midi" />
          <Block title="Souper" id="souper" />
          <Block title="Coucher" id="coucher" />
        </>
      )}

      {tab==="analyse" && (
        <div className="space-y-4">
          <p className="text-sm text-slate-300">Analyse de consistance simple.</p>
          <button onClick={exportCSV} className="w-full bg-green-600 py-2 rounded">
            Export médecin (CSV)
          </button>
        </div>
      )}

      {tab==="guide" && (
        <div className="text-sm space-y-2">
          {Object.values(SUPPLEMENTS).flat().map(s => (
            <div key={s.name} className="bg-slate-800 p-2 rounded">
              <strong>{s.name}</strong> – {s.dose}<br/>
              <span className="text-slate-300">{s.info}</span>
            </div>
          ))}
        </div>
      )}

      {tab==="parametres" && (
        <button
          className="w-full bg-red-600 py-2 rounded"
          onClick={() => { localStorage.clear(); location.reload(); }}>
          Réinitialiser toutes les données
        </button>
      )}
    </div>
  );

  function Block({ title, id }) {
    const day = new Date().toISOString().slice(0,10);
    const checked = data.logs?.[day]?.[id] || {};
    return (
      <div className="bg-slate-800 p-3 rounded mb-4">
        <h2 className="font-semibold mb-2">{title}</h2>

        {SUPPLEMENTS[id].map(s => (
          <label key={s.name} className="flex items-center mb-1">
            <input
              type="checkbox"
              checked={checked[s.name] || false}
              onChange={() => toggleSupplement(id, s.name)}
              className="mr-2"/>
            {s.name} <span className="text-xs text-slate-400 ml-1">{s.dose}</span>
          </label>
        ))}

        <textarea
          className="w-full mt-2 p-2 rounded bg-slate-900 text-white"
          placeholder="Note (dictée possible via micro clavier)"
          value={data.notes?.[day]?.[id] || ""}
          onChange={e => setNote(id, e.target.value)}
        />

        {["energie","immunite","stress"].map(k => (
          <div key={k} className="mt-2">
            <label className="text-xs">{k}</label>
            <input
              type="range" min="1" max="10"
              value={data.scores?.[day]?.[id]?.[k] || 5}
              onChange={e => setScore(id, k, e.target.value)}
              className="w-full"/>
          </div>
        ))}
      </div>
    );
  }
}

function Hydration({ data, setData }) {
  return (
    <div className="bg-slate-800 p-3 rounded mb-4">
      <p>Hydratation : {data.water} / 2000 ml</p>
      <button
        className="bg-blue-600 w-full mt-2 py-1 rounded"
        onClick={() => setData(d => ({...d, water: Math.min(2000, d.water + 250)}))}>
        +250 ml
      </button>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);

</script>
</body>
</html>


